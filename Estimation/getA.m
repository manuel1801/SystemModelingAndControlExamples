function A = getA(x,u)
%UNTITLED Summary of this function goes here
%   Detailed explanation goes here

% System parameters
m1 = 0.75;      % Mass 1
m2 = 1;         % Mass 2
g = 9.81;       % Gravity
L1 = 0.75;      % Length 1
L2 = 1;         % Length 2
l1 = 1/2*L1;    % Half-length 1
l2 = 1/2*L2;    % Half-length 2
J1 = m1*L1^2/12;    % Inertia 1
J2 = m2*L2^2/12;    % Inertia 2
r1 = 0.02; r2 = 0.04;   % Frictrion parameters

% Angular positions and velocities
q1 = x(1);
q2 = x(2);
q1_dot = x(3);
q2_dot = x(4);

% Evaluate A at state and parameters
A = [
 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                            1,                                                                                                                                                                                                                                    0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      0,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          0,                                                                                                                                                                                                                                                                            0,                                                                                                                                                                                                                                    1
                                                                                                                      (L1*g*l2^2*m2^2*cos(q1) - 2*L1*l2^3*m2^2*q2_dot^2*cos(q1 - q2) + 2*J2*L1*g*m2*cos(q1) + L1*g*l2^2*m2^2*cos(q1 - 2*q2) + 2*J2*g*l1*m1*cos(q1) - 2*L1^2*l2^2*m2^2*q1_dot^2*cos(2*q1 - 2*q2) - 2*L1*l2*m2*q2_dot*r2*sin(q1 - q2) - 2*J2*L1*l2*m2*q2_dot^2*cos(q1 - q2) + 2*g*l1*l2^2*m1*m2*cos(q1))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2) - (2*L1^2*l2^2*m2^2*sin(2*q1 - 2*q2)*(2*J2*u + 2*l2^2*m2*u - 2*J2*q1_dot*r1 - 2*l2^2*m2*q1_dot*r1 - 2*L1*l2^3*m2^2*q2_dot^2*sin(q1 - q2) + L1*g*l2^2*m2^2*sin(q1) + 2*J2*L1*g*m2*sin(q1) + L1*g*l2^2*m2^2*sin(q1 - 2*q2) + 2*J2*g*l1*m1*sin(q1) - L1^2*l2^2*m2^2*q1_dot^2*sin(2*q1 - 2*q2) + 2*L1*l2*m2*q2_dot*r2*cos(q1 - q2) - 2*J2*L1*l2*m2*q2_dot^2*sin(q1 - q2) + 2*g*l1*l2^2*m1*m2*sin(q1)))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)^2,                                                                                                                                                                                                                                                                                                                           (2*cos(2*q1 - 2*q2)*L1^2*l2^2*m2^2*q1_dot^2 + 2*cos(q1 - q2)*L1*l2^3*m2^2*q2_dot^2 - 2*g*cos(q1 - 2*q2)*L1*l2^2*m2^2 + 2*J2*cos(q1 - q2)*L1*l2*m2*q2_dot^2 + 2*r2*sin(q1 - q2)*L1*l2*m2*q2_dot)/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2) + (2*L1^2*l2^2*m2^2*sin(2*q1 - 2*q2)*(2*J2*u + 2*l2^2*m2*u - 2*J2*q1_dot*r1 - 2*l2^2*m2*q1_dot*r1 - 2*L1*l2^3*m2^2*q2_dot^2*sin(q1 - q2) + L1*g*l2^2*m2^2*sin(q1) + 2*J2*L1*g*m2*sin(q1) + L1*g*l2^2*m2^2*sin(q1 - 2*q2) + 2*J2*g*l1*m1*sin(q1) - L1^2*l2^2*m2^2*q1_dot^2*sin(2*q1 - 2*q2) + 2*L1*l2*m2*q2_dot*r2*cos(q1 - q2) - 2*J2*L1*l2*m2*q2_dot^2*sin(q1 - q2) + 2*g*l1*l2^2*m1*m2*sin(q1)))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)^2,                                                                           -(2*q1_dot*sin(2*q1 - 2*q2)*L1^2*l2^2*m2^2 + 2*r1*l2^2*m2 + 2*J2*r1)/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2), -(4*L1*l2^3*m2^2*q2_dot*sin(q1 - q2) - 2*L1*l2*m2*r2*cos(q1 - q2) + 4*J2*L1*l2*m2*q2_dot*sin(q1 - q2))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)
(2*cos(q1 - q2)*L1^3*l2*m2^2*q1_dot^2 + 2*cos(2*q1 - 2*q2)*L1^2*l2^2*m2^2*q2_dot^2 - 2*g*cos(2*q1 - q2)*L1^2*l2*m2^2 + 2*m1*cos(q1 - q2)*L1*l1^2*l2*m2*q1_dot^2 - 2*g*m1*cos(2*q1 - q2)*L1*l1*l2*m2 + 2*J1*cos(q1 - q2)*L1*l2*m2*q1_dot^2 - 2*r1*sin(q1 - q2)*L1*l2*m2*q1_dot + 2*u*sin(q1 - q2)*L1*l2*m2)/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2) - (2*L1^2*l2^2*m2^2*sin(2*q1 - 2*q2)*(2*L1^3*l2*m2^2*q1_dot^2*sin(q1 - q2) - 2*L1^2*m2*q2_dot*r2 - 2*l1^2*m1*q2_dot*r2 - L1^2*g*l2*m2^2*sin(2*q1 - q2) - 2*J1*q2_dot*r2 + L1^2*g*l2*m2^2*sin(q2) + 2*J1*g*l2*m2*sin(q2) + L1^2*l2^2*m2^2*q2_dot^2*sin(2*q1 - 2*q2) - 2*L1*l2*m2*u*cos(q1 - q2) + 2*L1*l2*m2*q1_dot*r1*cos(q1 - q2) + 2*J1*L1*l2*m2*q1_dot^2*sin(q1 - q2) + 2*g*l1^2*l2*m1*m2*sin(q2) - L1*g*l1*l2*m1*m2*sin(2*q1 - q2) + 2*L1*l1^2*l2*m1*m2*q1_dot^2*sin(q1 - q2) - L1*g*l1*l2*m1*m2*sin(q2)))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)^2, (2*L1^2*l2^2*m2^2*sin(2*q1 - 2*q2)*(2*L1^3*l2*m2^2*q1_dot^2*sin(q1 - q2) - 2*L1^2*m2*q2_dot*r2 - 2*l1^2*m1*q2_dot*r2 - L1^2*g*l2*m2^2*sin(2*q1 - q2) - 2*J1*q2_dot*r2 + L1^2*g*l2*m2^2*sin(q2) + 2*J1*g*l2*m2*sin(q2) + L1^2*l2^2*m2^2*q2_dot^2*sin(2*q1 - 2*q2) - 2*L1*l2*m2*u*cos(q1 - q2) + 2*L1*l2*m2*q1_dot*r1*cos(q1 - q2) + 2*J1*L1*l2*m2*q1_dot^2*sin(q1 - q2) + 2*g*l1^2*l2*m1*m2*sin(q2) - L1*g*l1*l2*m1*m2*sin(2*q1 - q2) + 2*L1*l1^2*l2*m1*m2*q1_dot^2*sin(q1 - q2) - L1*g*l1*l2*m1*m2*sin(q2)))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)^2 - (2*L1*l2*m2*u*sin(q1 - q2) - L1^2*g*l2*m2^2*cos(2*q1 - q2) + 2*L1^3*l2*m2^2*q1_dot^2*cos(q1 - q2) - L1^2*g*l2*m2^2*cos(q2) - 2*J1*g*l2*m2*cos(q2) + 2*L1^2*l2^2*m2^2*q2_dot^2*cos(2*q1 - 2*q2) - 2*L1*l2*m2*q1_dot*r1*sin(q1 - q2) + 2*J1*L1*l2*m2*q1_dot^2*cos(q1 - q2) - 2*g*l1^2*l2*m1*m2*cos(q2) - L1*g*l1*l2*m1*m2*cos(2*q1 - q2) + 2*L1*l1^2*l2*m1*m2*q1_dot^2*cos(q1 - q2) + L1*g*l1*l2*m1*m2*cos(q2))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2), (4*L1^3*l2*m2^2*q1_dot*sin(q1 - q2) + 2*L1*l2*m2*r1*cos(q1 - q2) + 4*J1*L1*l2*m2*q1_dot*sin(q1 - q2) + 4*L1*l1^2*l2*m1*m2*q1_dot*sin(q1 - q2))/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2),                  -(- 2*q2_dot*sin(2*q1 - 2*q2)*L1^2*l2^2*m2^2 + 2*r2*L1^2*m2 + 2*m1*r2*l1^2 + 2*J1*r2)/(2*J1*J2 + L1^2*l2^2*m2^2 + 2*J2*L1^2*m2 + 2*J2*l1^2*m1 + 2*J1*l2^2*m2 - L1^2*l2^2*m2^2*cos(2*q1 - 2*q2) + 2*l1^2*l2^2*m1*m2)];
 
% Discretize A % TODO: discretize first and then linearize for better results
sysc = ss(A,rand(4,1),zeros(2,4),0);
sysd = c2d(sysc, 0.05);
A = sysd.A;
end

